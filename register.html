<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-3 Capstone Project</title>
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
  </head>

</head>
  <body class="main-body">

  <!--* Top Nav bar section -->
  <!-- Navigation placeholder -->
  <div id="navbar-container"></div>
      

     <!-- Registration form  --> 
    
    <form class="regForm" onsubmit="submitForm(event)" novalidate>
      <div id="msg-toast" class="toast text-white" role="alert">
        <div id="toast-body" class="toast-body"></div>
      </div>
      
      <h1>Register with us</h1>
      <div class="row mb-3">
        <label for="userName3" class="col-sm-4 col-form-label">User Name</label>
        <div class="col-sm-8">
          <input type="userName" class="form-control regFormInput" id="userName3" placeholder="*" required>
        </div>
      </div>
      <div class="row mb-3">
        <label for="userId3" class="col-sm-4 col-form-label">User ID</label>
        <div class="col-sm-8">
          <input type="userId" class="form-control regFormInput" id="userId3">
        </div>
      </div>
      <div class="row mb-3">
        <label for="inputEmail3" class="col-sm-4 col-form-label">Email</label>
        <div class="col-sm-8">
          <input type="email" class="form-control regFormInput" id="inputEmail3" placeholder="* name@email.com" required>
        </div>
      </div>
      <div class="row mb-3">
        <label for="inputPassword3" class="col-sm-4 col-form-label">Password</label>
        <div class="col-sm-8">
          <input type="password" class="form-control regFormInput" id="inputPassword3" placeholder="*" required>
        </div>
      </div>
      
      <button type="submit" class="btn btn-primary">Submit</button>
      <button type="button" class="btn btn-primary" onclick="confirmCancel()">Cancel</button>
      
    </form>
    <!-- End Registration form -->

     
   <!-- Footer Container -->
  <div id="footer-container"></div>


  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous">
  </script>

  <!-- Load navbar script -->
  <script src="script/Mock.js"></script>  <!-- TODO: to remove in production env. --> 
  <script src="script/const.js"></script>
  <script src="script/auth.js"></script>
  
  <script src="script/navbar.js"></script>
  <script src="script/footer.js"></script>
        
    
    <!-- Import custom scripts -->
    <!-- <script src="./scripts/contact_util.js"></script> -->

<script>
  function showToast({ toastElement, toastBodyElement, bgColor, msg }) {
    toastBodyElement.textContent = msg;
    toastElement.className = `toast align-items-center text-white bg-${bgColor} border-0 show`;
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
  }

  async function submitForm(event) {
    event.preventDefault();

    const toastMsgExample = document.getElementById('msg-toast');
    const toastBodyExample = document.getElementById('toast-body');
    
    const userName = document.getElementById("userName3");
    const userId = document.getElementById("userId3");
    
    const email = document.getElementById("inputEmail3");
    const password = document.getElementById("inputPassword3");

    if (userName.value.trim() === "" || userId.value.trim() === "" || email.value.trim() === "" || password.value.trim() === "") {
      showToast({
        toastElement: toastMsgExample,
        toastBodyElement: toastBodyExample,
        bgColor: "danger",
        msg: "Please enter all inputs."
      });
      return;
    }

    /*
      A valid username should start with an alphabet so, [A-Za-z]. 
      All other characters can be alphabets, numbers or an underscore 
      so, [A-Za-z0-9_]. Since length constraint was given as 8-30 and 
      we had already fixed the first character, so we give {7,29}..
    
    const userNameRegex = /^[A-Za-z][A-Za-z0-9_]{7,29}$/;
    */
    
    /*
      A valid username should be alphanumeric_, length {8,20}
    */
    const userNameRegex = /^[A-Za-z0-9_]{8,20}$/;
    if (!userNameRegex.test(userName.value)) {
      showToast({
        toastElement: toastMsgExample,
        toastBodyElement: toastBodyExample,
        bgColor: "danger",
        msg: "Invalid User name - alphanumeric_ 8-20"
      });
      return;
    }
    
    
    /*
      A valid userId should be alphanumeric_, length {8,20}
    */
    const useridRegex = /^[A-Za-z0-9_]{8,20}$/;
    if (!useridRegex.test(userId.value)) {
      showToast({
        toastElement: toastMsgExample,
        toastBodyElement: toastBodyExample,
        bgColor: "danger",
        msg: "Invalid User ID - alphanumeric_ 8-20"
      });
      return;
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email.value)) {
      showToast({
        toastElement: toastMsgExample,
        toastBodyElement: toastBodyExample,
        bgColor: "danger",
        msg: "Email is not valid."
      });
      return;
    }

    /*
      the password consists of only alphanumeric characters and 
      is between eight and sixteen characters in length.
    */
    const pwdRegex = /^[a-zA-Z0-9]{8,16}$/;
    if (!pwdRegex.test(password.value)) {
      showToast({
        toastElement: toastMsgExample,
        toastBodyElement: toastBodyExample,
        bgColor: "danger",
        msg: "Invalid Password - alphanumeric 8-16"
      });
      return;
    }

    const formData = { email: email.value, password: password.value };

    try {
      const response = await fetch("https://getform.io/f/bkkywpzb", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      });

      if (response.ok) {
        showToast({
          toastElement: toastMsgExample,
          toastBodyElement: toastBodyExample,
          bgColor: "success",
          msg: "Your data has been sent. Thank you."
        });
        email.value = "";
        password.value = "";
      } else {
        throw new Error("Submission failed");
      }
    } catch (error) {
      showToast({
        toastElement: toastMsgExample,
        toastBodyElement: toastBodyExample,
        bgColor: "danger",
        msg: "Error sending data. Please try again."
      });
    }
  }
</script>

<script>
  function confirmCancel() {
    const confirmExit = confirm("Are you sure you want to cancel and leave this page?");
    if (confirmExit) {
      // Redirect to placeholder or real page
      window.location.href = "index.html"; // Replace with actual page when it's ready
    }
  }
</script>

  </body>
</html>